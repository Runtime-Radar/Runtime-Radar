syntax = "proto3";

package integration;

import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "google/protobuf/empty.proto";

option go_package = "./api";
option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    title: "Integration API";
  };
};

service IntegrationController {
  rpc Create(Integration) returns (CreateIntegrationResp) {
    option (google.api.http) = {
      post: "/api/v1/integration"
      body: "*"
    };
  }
  rpc Read(ReadIntegrationReq) returns (Integration)  {
    option (google.api.http) = {
      get: "/api/v1/integration/{type}/{id}"
    };
  }
  rpc Update(Integration) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      patch: "/api/v1/integration/{id}"
      body: "*"
    };
  }
  rpc Delete(DeleteIntegrationReq) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/v1/integration/{type}/{id}"
    };
  }
  rpc List(ListIntegrationReq) returns (ListIntegrationResp) {
    option (google.api.http) = {
      get: "/api/v1/integration/{type}/list"
    };
  }
}

message Integration {
  string id = 1;
  string name = 2;
  string type = 3;
  // Skip check on add
  bool skip_check = 4;
  oneof config {
    Email email = 5;
    Webhook webhook = 6;
    Syslog syslog = 7;
  }
}

message Email {
  enum AuthType {
    AUTH_TYPE_PLAIN = 0;
    AUTH_TYPE_LOGIN = 1;
    AUTH_TYPE_CRAM_MD5 = 2;
    AUTH_TYPE_NONE = 3;
  }

  string from = 1;
  string server = 2;
  AuthType auth_type = 3;
  string username = 4;
  string password = 5;
  // Send over TLS
  bool use_tls = 6;
  // Send with STARTTLS
  bool use_start_tls = 7;
  // InsecureSkipVerify
  bool insecure = 8;
  string ca = 9;
}

message Webhook {
  string url = 1;
  string login = 2;
  string password = 3;
  bool insecure = 4;
  string ca = 5;
}

message Syslog {
  string address = 1;
}

message CreateIntegrationResp {
  string id = 1;
}

message ReadIntegrationReq {
  string type = 1;
  string id = 2;
}

message DeleteIntegrationReq {
  string type = 1;
  string id = 2;
}

message ListIntegrationReq {
  string order = 1;
  string type = 2;
}

message ListIntegrationResp {
  repeated Integration integrations = 1;
}
