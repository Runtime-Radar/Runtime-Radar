{{- if and .Values.ingress.enabled (empty .Values.ingress.tls.existingSecret) (eq (include "common.cs.tls.enabled" .) "true") }}
{{- $secretName := include "reverse-proxy.tls.secretName" . }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ include "common.namespace" . | quote }}
  labels:
    {{- include "common.labels" . | nindent 4 }}
  {{- with (include "common.annotations" .) }}
  annotations:
    {{- . | nindent 4 }}
  {{- end }}
type: kubernetes.io/tls
data:
  {{- $altNames := (include "reverse-proxy.hosts" . | fromYaml).hosts }}
  {{- include "common.tls.generateSecret" (dict "context" . "values" .Values.ingress "secret" $secretName "altNames" $altNames) | indent 2 }}
{{- end }}
