<ng-container *transloco="let tUser; prefix: 'user'">
    <kbq-sidepanel-header [closeable]="true">
        {{ props.isEdit ? tUser('User.EditForm.Title.Edit') : tUser('User.CreateForm.Title.Create') }}
    </kbq-sidepanel-header>

    <kbq-sidepanel-body *transloco="let tCommon; prefix: 'common'">
        <form [formGroup]="form" class="kbq-form-vertical">
            @if (!props.isEdit) {
                <section class="kbq-form__row kbq-form-row_margin">
                    <label for="username" class="kbq-form__label">
                        {{ tUser('User.CreateForm.Label.Username') }}
                    </label>
                    <kbq-form-field class="kbq-form__control">
                        <input kbqInput
                               cdkFocusInitial
                               type="text"
                               id="username"
                               formControlName="username"
                               data-testid="user-username-input">
                    </kbq-form-field>
                </section>
            }

            <section class="kbq-form__row kbq-form-row_margin">
                <label for="email" class="kbq-form__label">
                    {{ tUser('User.CreateForm.Label.Email') }}
                </label>
                <kbq-form-field class="kbq-form__control">
                    <input kbqInput
                           type="text"
                           id="email"
                           formControlName="email"
                           data-testid="user-email-input">
                    @if (form.get('email')?.invalid) {
                        <kbq-hint color="error">{{ tCommon('Common.Form.Error.Format') }}</kbq-hint>
                    }
                </kbq-form-field>
            </section>

            @if (!props.isEdit || ((isAdminRole$ | async) === true)) {
                <section class="kbq-form__row kbq-form-row_margin">
                    <label for="password" class="kbq-form__label">
                        {{ tUser('User.CreateForm.Label.Password') }}
                    </label>
                    <kbq-form-field class="kbq-form__control">
                        <input kbqInputPassword
                               type="password"
                               id="password"
                               formControlName="password"
                               data-testid="user-password-input">
                        <kbq-password-toggle
                                [kbqTooltipNotHidden]="tUser('User.CreateForm.Hint.HidePassword')"
                                [kbqTooltipHidden]="tUser('User.CreateForm.Hint.ShowPassword')"></kbq-password-toggle>
                        <kbq-password-hint [rule]="passwordRules.Length" [min]="8" [max]="16">
                            {{ tCommon('Common.Form.PasswordRules.Length', { min: 8, max: 16 }) }}
                        </kbq-password-hint>
                        <kbq-password-hint [rule]="passwordRules.UpperLatin">
                            {{ tCommon('Common.Form.PasswordRules.UpperLatin') }}
                        </kbq-password-hint>
                        <kbq-password-hint [rule]="passwordRules.LowerLatin">
                            {{ tCommon('Common.Form.PasswordRules.LowerLatin') }}
                        </kbq-password-hint>
                        <kbq-password-hint [rule]="passwordRules.Digit">
                            {{ tCommon('Common.Form.PasswordRules.Digit') }}
                        </kbq-password-hint>
                    </kbq-form-field>
                </section>
            }

            <section class="kbq-form__row">
                <label for="roleId" class="kbq-form__label">
                    {{ tUser('User.CreateForm.Label.Role') }}
                </label>
                <kbq-form-field class="kbq-form__control">
                    <kbq-select id="roleId"
                                formControlName="roleId"
                                data-testid="user-roleid-select">
                        @for (role of props.roles$ | async; track role.id) {
                            <kbq-option [value]="role.id"
                                        [attr.data-testid]="role.role_name">
                                {{ role.role_name }}
                            </kbq-option>
                        }
                    </kbq-select>
                </kbq-form-field>
            </section>
        </form>
    </kbq-sidepanel-body>

    <kbq-sidepanel-footer>
        <kbq-sidepanel-actions align="left">
            <button kbq-button
                    kbqStyle="outline"
                    color="theme-fade"
                    type="button"
                    [disabled]="(isFormValid$ | async) === false"
                    (click)="confirm()"
                    data-testid="user-confirm-button">
                {{ props.isEdit ? tUser('User.EditForm.Button.Confirm') : tUser('User.CreateForm.Button.Confirm') }}
            </button>
        </kbq-sidepanel-actions>
        <kbq-sidepanel-actions align="right">
            <button kbq-button
                    type="button"
                    (click)="cancel()"
                    data-testid="user-cancel-button">
                {{ tUser('User.CreateForm.Button.Cancel') }}
            </button>
        </kbq-sidepanel-actions>
    </kbq-sidepanel-footer>
</ng-container>
